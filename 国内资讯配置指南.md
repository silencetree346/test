# å›½å†…å’–å•¡èµ„è®¯è·å–é…ç½®æŒ‡å— ğŸ‡¨ğŸ‡³

## ğŸ“‹ æ¦‚è¿°

ç”±äºæµè§ˆå™¨çš„ **CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰é™åˆ¶**ï¼Œå‰ç«¯æ— æ³•ç›´æ¥è®¿é—®å¤§å¤šæ•°å›½å†…æ–°é—»ç½‘ç«™çš„APIã€‚è¦è·å–å›½å†…å’–å•¡è¡Œä¸šèµ„è®¯ï¼Œéœ€è¦é…ç½®åç«¯APIä»£ç†ã€‚

---

## ğŸ¯ æ¨èçš„å›½å†…èµ„è®¯æº

### å•†ä¸šè´¢ç»ç±»

| å¹³å° | ç‰¹ç‚¹ | é€‚åˆåœºæ™¯ |
|------|------|---------|
| **36æ°ª** | ç§‘æŠ€åˆ›æŠ•è§†è§’ï¼Œå…³æ³¨æ–°æ¶ˆè´¹å“ç‰Œ | è¡Œä¸šè¶‹åŠ¿ã€èèµ„åŠ¨æ€ã€åˆ›ä¸šå…¬å¸ |
| **è™å—…** | æ·±åº¦å•†ä¸šåˆ†æï¼Œè¡Œä¸šæ´å¯Ÿ | å¸‚åœºåˆ†æã€è¡Œä¸šæŠ¥å‘Šã€è¶‹åŠ¿åˆ¤æ–­ |
| **é’›åª’ä½“** | ç§‘æŠ€å•†ä¸šèµ„è®¯ï¼Œæ•°æ®åˆ†æ | æ•°æ®æŠ¥å‘Šã€è¡Œä¸šç ”ç©¶ã€å•†ä¸šæ¨¡å¼ |
| **è‰¾ç‘å’¨è¯¢** | ä¸“ä¸šå¸‚åœºç ”ç©¶æŠ¥å‘Š | å¸‚åœºè§„æ¨¡ã€ç”¨æˆ·ç”»åƒã€è¶‹åŠ¿é¢„æµ‹ |

### å’–å•¡è¡Œä¸šå‚ç›´åª’ä½“

| å¹³å° | ç‰¹ç‚¹ | é€‚åˆåœºæ™¯ |
|------|------|---------|
| **å’–é—¨** | å’–å•¡è¡Œä¸šå‚ç›´åª’ä½“ | äº§å“åˆ›æ–°ã€å“ç‰ŒåŠ¨æ€ã€é—¨åº—è¿è¥ |
| **å“ç‰Œæ˜Ÿçƒ** | æ–°æ¶ˆè´¹å“ç‰Œè§‚å¯Ÿ | å“ç‰Œç­–ç•¥ã€è¥é”€æ¡ˆä¾‹ã€æ¶ˆè´¹è¶‹åŠ¿ |
| **FBIFé£Ÿå“é¥®æ–™åˆ›æ–°** | é£Ÿå“é¥®æ–™è¡Œä¸šåˆ›æ–° | äº§å“ç ”å‘ã€é…æ–¹åˆ›æ–°ã€ä¾›åº”é“¾ |

---

## ğŸš€ æ–¹æ¡ˆ1ï¼šä½¿ç”¨ Node.js åç«¯ä»£ç†ï¼ˆæ¨èï¼‰

### æ­¥éª¤1ï¼šåˆ›å»ºåç«¯é¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹
mkdir coffee-news-backend
cd coffee-news-backend

# åˆå§‹åŒ– Node.js é¡¹ç›®
npm init -y

# å®‰è£…ä¾èµ–
npm install express axios cors dotenv
```

### æ­¥éª¤2ï¼šåˆ›å»º API ä»£ç†æœåŠ¡

åˆ›å»º `server.js`ï¼š

```javascript
const express = require('express');
const axios = require('axios');
const cors = require('cors');
require('dotenv').config();

const app = express();
const PORT = process.env.PORT || 3001;

// å¯ç”¨ CORS
app.use(cors());
app.use(express.json());

// 36æ°ªèµ„è®¯APIä»£ç†
app.get('/api/36kr-news', async (req, res) => {
    try {
        const { keyword = 'å’–å•¡', days = 1 } = req.query;
        
        // 36æ°ªçš„APIï¼ˆéœ€è¦ç”³è¯·API Keyï¼‰
        const response = await axios.get('https://api.36kr.com/api/search', {
            params: {
                q: keyword,
                type: 'article',
                per_page: 20
            },
            headers: {
                'Authorization': `Bearer ${process.env.KR36_API_KEY}`
            }
        });
        
        const articles = response.data.data.items.map(item => ({
            title: item.title,
            url: item.url,
            source: '36æ°ª',
            publish_date: item.published_at.split(' ')[0],
            summary: item.summary || item.title
        }));
        
        res.json(articles);
    } catch (error) {
        console.error('36æ°ªAPIé”™è¯¯:', error.message);
        res.status(500).json({ error: 'è·å–36æ°ªèµ„è®¯å¤±è´¥' });
    }
});

// è™å—…èµ„è®¯APIä»£ç†
app.get('/api/huxiu-news', async (req, res) => {
    try {
        const { keyword = 'å’–å•¡', days = 1 } = req.query;
        
        // è™å—…çš„APIæˆ–RSS
        const response = await axios.get('https://www.huxiu.com/v2_action/article_list', {
            params: {
                type: 0,
                page: 1,
                pagesize: 20
            }
        });
        
        // è¿‡æ»¤å’–å•¡ç›¸å…³å†…å®¹
        const articles = response.data.data
            .filter(item => item.title.includes(keyword))
            .map(item => ({
                title: item.title,
                url: `https://www.huxiu.com/article/${item.aid}.html`,
                source: 'è™å—…',
                publish_date: new Date(item.published_at * 1000).toISOString().split('T')[0],
                summary: item.description || item.title
            }));
        
        res.json(articles);
    } catch (error) {
        console.error('è™å—…APIé”™è¯¯:', error.message);
        res.status(500).json({ error: 'è·å–è™å—…èµ„è®¯å¤±è´¥' });
    }
});

// å’–é—¨èµ„è®¯ï¼ˆRSSè®¢é˜…ï¼‰
app.get('/api/kafmen-news', async (req, res) => {
    try {
        // ä½¿ç”¨ RSS è§£æ
        const Parser = require('rss-parser');
        const parser = new Parser();
        
        const feed = await parser.parseURL('https://www.kafmen.cn/feed');
        
        const articles = feed.items.slice(0, 20).map(item => ({
            title: item.title,
            url: item.link,
            source: 'å’–é—¨',
            publish_date: new Date(item.pubDate).toISOString().split('T')[0],
            summary: item.contentSnippet || item.title
        }));
        
        res.json(articles);
    } catch (error) {
        console.error('å’–é—¨RSSé”™è¯¯:', error.message);
        res.status(500).json({ error: 'è·å–å’–é—¨èµ„è®¯å¤±è´¥' });
    }
});

// èšåˆæ‰€æœ‰å›½å†…èµ„è®¯
app.get('/api/chinese-coffee-news', async (req, res) => {
    try {
        const { days = 1 } = req.query;
        
        // å¹¶å‘è¯·æ±‚å¤šä¸ªèµ„è®¯æº
        const [kr36, huxiu, kafmen] = await Promise.allSettled([
            axios.get(`http://localhost:${PORT}/api/36kr-news?days=${days}`),
            axios.get(`http://localhost:${PORT}/api/huxiu-news?days=${days}`),
            axios.get(`http://localhost:${PORT}/api/kafmen-news?days=${days}`)
        ]);
        
        const allNews = [];
        
        if (kr36.status === 'fulfilled') allNews.push(...kr36.value.data);
        if (huxiu.status === 'fulfilled') allNews.push(...huxiu.value.data);
        if (kafmen.status === 'fulfilled') allNews.push(...kafmen.value.data);
        
        // æŒ‰æ—¥æœŸæ’åº
        allNews.sort((a, b) => new Date(b.publish_date) - new Date(a.publish_date));
        
        console.log(`âœ… æˆåŠŸèšåˆ ${allNews.length} æ¡å›½å†…èµ„è®¯`);
        res.json(allNews);
    } catch (error) {
        console.error('èšåˆèµ„è®¯é”™è¯¯:', error.message);
        res.status(500).json({ error: 'èšåˆå›½å†…èµ„è®¯å¤±è´¥' });
    }
});

app.listen(PORT, () => {
    console.log(`ğŸš€ å’–å•¡èµ„è®¯APIæœåŠ¡å·²å¯åŠ¨: http://localhost:${PORT}`);
});
```

### æ­¥éª¤3ï¼šé…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
PORT=3001
KR36_API_KEY=your_36kr_api_key_here
HUXIU_API_KEY=your_huxiu_api_key_here
```

### æ­¥éª¤4ï¼šå¯åŠ¨åç«¯æœåŠ¡

```bash
node server.js
```

### æ­¥éª¤5ï¼šä¿®æ”¹å‰ç«¯ä»£ç 

åœ¨ `docs/index.html` çš„ `fetchChineseNews` æ–¹æ³•ä¸­ï¼š

```javascript
async fetchChineseNews() {
    console.log('ğŸ‡¨ğŸ‡³ è·å–å›½å†…å’–å•¡èµ„è®¯...');
    
    try {
        // è°ƒç”¨æœ¬åœ°åç«¯API
        const response = await axios.get('http://localhost:3001/api/chinese-coffee-news', {
            params: { days: 1 },
            timeout: 10000
        });
        
        console.log(`âœ… æˆåŠŸè·å– ${response.data.length} æ¡å›½å†…èµ„è®¯`);
        return response.data;
    } catch (error) {
        console.error('âŒ å›½å†…èµ„è®¯è·å–å¤±è´¥:', error.message);
        return [];
    }
}
```

---

## ğŸš€ æ–¹æ¡ˆ2ï¼šä½¿ç”¨ Python Flask åç«¯ï¼ˆé€‚åˆæœ‰PythonåŸºç¡€çš„ç”¨æˆ·ï¼‰

### æ­¥éª¤1ï¼šåˆ›å»º Flask é¡¹ç›®

```bash
# åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹
mkdir coffee-news-backend
cd coffee-news-backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate  # Mac/Linux
# venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install flask flask-cors requests feedparser
```

### æ­¥éª¤2ï¼šåˆ›å»º `app.py`

```python
from flask import Flask, request, jsonify
from flask_cors import CORS
import requests
import feedparser
from datetime import datetime, timedelta

app = Flask(__name__)
CORS(app)  # å…è®¸è·¨åŸŸ

@app.route('/api/chinese-coffee-news', methods=['GET'])
def get_chinese_coffee_news():
    """èšåˆå›½å†…å’–å•¡èµ„è®¯"""
    days = int(request.args.get('days', 1))
    keyword = request.args.get('keyword', 'å’–å•¡')
    
    all_news = []
    
    # 1. è·å–36æ°ªèµ„è®¯
    try:
        kr36_news = fetch_36kr_news(keyword, days)
        all_news.extend(kr36_news)
        print(f"âœ… 36æ°ª: {len(kr36_news)}æ¡")
    except Exception as e:
        print(f"âŒ 36æ°ªå¤±è´¥: {str(e)}")
    
    # 2. è·å–è™å—…èµ„è®¯
    try:
        huxiu_news = fetch_huxiu_news(keyword, days)
        all_news.extend(huxiu_news)
        print(f"âœ… è™å—…: {len(huxiu_news)}æ¡")
    except Exception as e:
        print(f"âŒ è™å—…å¤±è´¥: {str(e)}")
    
    # 3. è·å–å’–é—¨RSS
    try:
        kafmen_news = fetch_kafmen_rss()
        all_news.extend(kafmen_news)
        print(f"âœ… å’–é—¨: {len(kafmen_news)}æ¡")
    except Exception as e:
        print(f"âŒ å’–é—¨å¤±è´¥: {str(e)}")
    
    # æŒ‰æ—¥æœŸæ’åº
    all_news.sort(key=lambda x: x['publish_date'], reverse=True)
    
    return jsonify(all_news)

def fetch_36kr_news(keyword, days):
    """è·å–36æ°ªèµ„è®¯"""
    # è¿™é‡Œéœ€è¦æ ¹æ®36æ°ªå®é™…APIè°ƒæ•´
    url = 'https://36kr.com/api/search-column'
    params = {'keyword': keyword, 'per_page': 20}
    
    response = requests.get(url, params=params, timeout=10)
    data = response.json()
    
    articles = []
    for item in data.get('data', {}).get('items', []):
        articles.append({
            'title': item['title'],
            'url': item['item_url'],
            'source': '36æ°ª',
            'publish_date': item['published_at'].split(' ')[0],
            'summary': item.get('summary', item['title'])
        })
    
    return articles

def fetch_huxiu_news(keyword, days):
    """è·å–è™å—…èµ„è®¯"""
    # è¿™é‡Œéœ€è¦æ ¹æ®è™å—…å®é™…APIè°ƒæ•´
    url = 'https://www.huxiu.com/v2_action/article_list'
    params = {'type': 0, 'page': 1, 'pagesize': 20}
    
    response = requests.get(url, params=params, timeout=10)
    data = response.json()
    
    articles = []
    for item in data.get('data', []):
        if keyword in item['title']:
            articles.append({
                'title': item['title'],
                'url': f"https://www.huxiu.com/article/{item['aid']}.html",
                'source': 'è™å—…',
                'publish_date': datetime.fromtimestamp(item['published_at']).strftime('%Y-%m-%d'),
                'summary': item.get('description', item['title'])
            })
    
    return articles

def fetch_kafmen_rss():
    """è·å–å’–é—¨RSS"""
    feed = feedparser.parse('https://www.kafmen.cn/feed')
    
    articles = []
    for entry in feed.entries[:20]:
        articles.append({
            'title': entry.title,
            'url': entry.link,
            'source': 'å’–é—¨',
            'publish_date': datetime(*entry.published_parsed[:3]).strftime('%Y-%m-%d'),
            'summary': entry.get('summary', entry.title)
        })
    
    return articles

if __name__ == '__main__':
    print('ğŸš€ å’–å•¡èµ„è®¯APIæœåŠ¡å·²å¯åŠ¨: http://localhost:3001')
    app.run(host='0.0.0.0', port=3001, debug=True)
```

### æ­¥éª¤3ï¼šè¿è¡Œåç«¯

```bash
python app.py
```

---

## ğŸš€ æ–¹æ¡ˆ3ï¼šä½¿ç”¨ RSS è®¢é˜…æºï¼ˆæœ€ç®€å•ï¼Œä½†èµ„è®¯æœ‰é™ï¼‰

å¦‚æœä¸æƒ³é…ç½®åç«¯ï¼Œå¯ä»¥ç›´æ¥åœ¨å‰ç«¯ä½¿ç”¨ RSS è§£ææœåŠ¡ã€‚

### ä½¿ç”¨ RSS2JSON æœåŠ¡

```javascript
async fetchChineseNews() {
    console.log('ğŸ‡¨ğŸ‡³ é€šè¿‡RSSè·å–å›½å†…èµ„è®¯...');
    
    const chineseNews = [];
    
    // å’–é—¨ RSS
    try {
        const rss2jsonUrl = 'https://api.rss2json.com/v1/api.json';
        const response = await axios.get(rss2jsonUrl, {
            params: {
                rss_url: 'https://www.kafmen.cn/feed',
                api_key: 'YOUR_RSS2JSON_API_KEY',  // éœ€è¦æ³¨å†Œè·å–
                count: 20
            }
        });
        
        if (response.data.status === 'ok') {
            const articles = response.data.items.map(item => ({
                title: item.title,
                url: item.link,
                source: 'å’–é—¨',
                publish_date: item.pubDate.split(' ')[0],
                summary: item.description.replace(/<[^>]*>/g, '').substring(0, 150)
            }));
            
            chineseNews.push(...articles);
            console.log(`âœ… å’–é—¨: ${articles.length}æ¡`);
        }
    } catch (error) {
        console.warn('âš ï¸ å’–é—¨RSSè·å–å¤±è´¥:', error.message);
    }
    
    return chineseNews;
}
```

---

## ğŸ“Š APIå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **Node.js åç«¯** | çµæ´»ã€åŠŸèƒ½å¼ºå¤§ã€æ”¯æŒå¤šç§API | éœ€è¦éƒ¨ç½²æœåŠ¡å™¨ | ç”Ÿäº§ç¯å¢ƒã€å®Œæ•´é¡¹ç›® |
| **Python Flask** | æ˜“äºå¼€å‘ã€çˆ¬è™«å‹å¥½ | éœ€è¦Pythonç¯å¢ƒ | å¿«é€ŸåŸå‹ã€æ•°æ®åˆ†æ |
| **RSSè®¢é˜…** | ç®€å•ã€æ— éœ€åç«¯ | èµ„è®¯æºæœ‰é™ã€æ›´æ–°æ…¢ | ä¸ªäººä½¿ç”¨ã€æ¼”ç¤º |

---

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. æ£€æŸ¥CORSé—®é¢˜

åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹ï¼š

```
Access to XMLHttpRequest at 'xxx' from origin 'xxx' has been blocked by CORS policy
```

**è§£å†³æ–¹æ³•ï¼š**
- åç«¯æ·»åŠ  CORS å¤´
- ä½¿ç”¨ä»£ç†æœåŠ¡å™¨

### 2. æµ‹è¯•åç«¯API

```bash
# æµ‹è¯•èšåˆAPI
curl http://localhost:3001/api/chinese-coffee-news?days=1

# æµ‹è¯•å•ä¸ªèµ„è®¯æº
curl http://localhost:3001/api/36kr-news?keyword=å’–å•¡
```

### 3. æŸ¥çœ‹ç½‘ç»œè¯·æ±‚

åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…· â†’ Network æ ‡ç­¾ä¸­ï¼š
- æ£€æŸ¥è¯·æ±‚çŠ¶æ€ï¼ˆ200/404/500ï¼‰
- æŸ¥çœ‹å“åº”æ•°æ®æ ¼å¼
- æ£€æŸ¥è¯·æ±‚è€—æ—¶

---

## ğŸš€ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### ä½¿ç”¨ Vercel éƒ¨ç½²ï¼ˆæ¨èï¼‰

1. **åˆ›å»º `vercel.json`ï¼š**

```json
{
  "version": 2,
  "builds": [
    {
      "src": "server.js",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "server.js"
    }
  ]
}
```

2. **éƒ¨ç½²ï¼š**

```bash
npm install -g vercel
vercel
```

### ä½¿ç”¨ Heroku éƒ¨ç½²

```bash
# åˆ›å»º Procfile
echo "web: node server.js" > Procfile

# éƒ¨ç½²
git init
heroku create coffee-news-api
git add .
git commit -m "Initial commit"
git push heroku main
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### æ³•å¾‹åˆè§„

1. **éµå®ˆç½‘ç«™çš„ robots.txt è§„åˆ™**
2. **ä¸è¦é¢‘ç¹è¯·æ±‚ï¼Œé¿å…ç»™æœåŠ¡å™¨é€ æˆå‹åŠ›**
3. **å°Šé‡ç‰ˆæƒï¼Œæ³¨æ˜èµ„è®¯æ¥æº**
4. **ä»…ç”¨äºä¸ªäººå­¦ä¹ å’Œç ”ç©¶**

### APIé™åˆ¶

- å¤§å¤šæ•°APIæœ‰è¯·æ±‚é¢‘ç‡é™åˆ¶
- éœ€è¦å®šæœŸæ›´æ–°API Key
- æ³¨æ„ç¼“å­˜ç­–ç•¥ï¼Œé¿å…é‡å¤è¯·æ±‚

---

## ğŸ¯ æ¨èé…ç½®

### å¼€å‘ç¯å¢ƒ

```
å‰ç«¯: http://localhost:8000 (docs/index.html)
åç«¯: http://localhost:3001 (Node.js/Python)
```

### ç”Ÿäº§ç¯å¢ƒ

```
å‰ç«¯: https://yourusername.github.io/test/
åç«¯: https://coffee-news-api.vercel.app
```

---

## âœ… å®Œæ•´æµç¨‹æ€»ç»“

1. **é€‰æ‹©æ–¹æ¡ˆ**ï¼šæ ¹æ®æŠ€æœ¯æ ˆé€‰æ‹© Node.jsã€Python æˆ– RSS
2. **é…ç½®åç«¯**ï¼šåˆ›å»ºAPIä»£ç†æœåŠ¡
3. **æµ‹è¯•API**ï¼šç¡®ä¿åç«¯èƒ½æ­£å¸¸è¿”å›æ•°æ®
4. **ä¿®æ”¹å‰ç«¯**ï¼šæ›´æ–° `fetchChineseNews` æ–¹æ³•
5. **æœ¬åœ°æµ‹è¯•**ï¼šéªŒè¯å›½å†…èµ„è®¯èƒ½æ­£å¸¸æ˜¾ç¤º
6. **éƒ¨ç½²ä¸Šçº¿**ï¼šéƒ¨ç½²åç«¯å’Œå‰ç«¯

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** è¯·æŸ¥çœ‹ï¼š
- Node.js å®˜æ–¹æ–‡æ¡£ï¼šhttps://nodejs.org/
- Flask å®˜æ–¹æ–‡æ¡£ï¼šhttps://flask.palletsprojects.com/
- RSS2JSON APIï¼šhttps://rss2json.com/

**ç°åœ¨æ‚¨å¯ä»¥è·å–ä¸°å¯Œçš„å›½å†…å’–å•¡è¡Œä¸šèµ„è®¯äº†ï¼** ğŸ‡¨ğŸ‡³â˜•âœ¨


